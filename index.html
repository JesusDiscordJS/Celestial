<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Celestial User Tracker - Sistema de Rastreamento Discord</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif;
      background: url('https://user-images.githubusercontent.com/74038190/225813708-98b745f2-7d22-48cf-9150-083f1b00d6c9.gif') no-repeat center center fixed;
      background-size: cover;
      color: #dcddde;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .container {
      text-align: center;
      padding: 40px 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      margin-bottom: 50px;
      animation: slideDown 0.8s ease-out;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .logo {
      width: 140px;
      height: 140px;
      margin-bottom: 25px;
      border-radius: 50%;
      box-shadow: 0 15px 40px rgba(0,0,0,0.6);
      transition: transform 0.3s ease;
      animation: pulse 2s infinite ease-in-out;
    }

    .logo:hover {
      transform: scale(1.1);
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 15px 40px rgba(0,0,0,0.6); }
      50% { box-shadow: 0 20px 50px rgba(114, 137, 218, 0.7); }
    }

    h1.page-title {
      font-size: 3.2rem;
      margin-bottom: 20px;
      color: #ffffff;
      font-weight: 700;
      text-shadow: 0px 0px 12px rgba(0,0,0,0.8);
      background: linear-gradient(135deg, #7289da, #43b581, #faa61a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.4rem;
      color: #b9bbbe;
      margin-bottom: 15px;
      font-weight: 500;
    }

    p.description {
      color: #e0e0e0;
      font-size: 1.1rem;
      margin-bottom: 30px;
      text-shadow: 0px 0px 8px rgba(0,0,0,0.7);
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.7;
    }

    .features-info {
      background: rgba(47, 49, 54, 0.8);
      border-radius: 12px;
      padding: 25px;
      margin: 30px auto 40px;
      max-width: 900px;
      border: 1px solid #43b581;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }

    .features-info h3 {
      color: #43b581;
      font-size: 1.3rem;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .feature-item {
      background: rgba(64, 68, 75, 0.6);
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #7289da;
      text-align: left;
    }

    .feature-item h4 {
      color: #ffffff;
      margin: 0 0 10px 0;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .feature-item p {
      color: #b9bbbe;
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .search-container {
      margin-bottom: 40px;
      animation: fadeInUp 1s ease-out 0.2s both;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .input-group {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
      max-width: 600px;
      margin: 0 auto;
    }

    input {
      padding: 18px 25px;
      width: 350px;
      max-width: 100%;
      border: 2px solid #43b581;
      border-radius: 10px;
      font-size: 1.1rem;
      background-color: #40444b;
      color: #dcddde;
      transition: all 0.3s ease;
      outline: none;
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }

    input:focus {
      border-color: #7289da;
      box-shadow: 0 0 0 4px rgba(114, 137, 218, 0.3);
      background-color: #36393f;
      transform: translateY(-2px);
    }

    input::placeholder {
      color: #8e9297;
    }

    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 18px 35px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      min-width: 140px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #7289da, #5b6eae);
      box-shadow: 0 6px 15px rgba(114, 137, 218, 0.4);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #677bc4, #4e5d96);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(114, 137, 218, 0.5);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #43b581, #369866);
      box-shadow: 0 6px 15px rgba(67, 181, 129, 0.4);
    }

    .btn-secondary:hover {
      background: linear-gradient(135deg, #3ca374, #2d7a56);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(67, 181, 129, 0.5);
    }

    .btn-info {
      background: linear-gradient(135deg, #faa61a, #e8960f);
      box-shadow: 0 6px 15px rgba(250, 166, 26, 0.4);
    }

    .btn-info:hover {
      background: linear-gradient(135deg, #e8960f, #d18608);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(250, 166, 26, 0.5);
    }

    button:active {
      transform: translateY(0);
    }

    button.loading {
      pointer-events: none;
      opacity: 0.8;
    }

    button.loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid transparent;
      border-top: 2px solid #ffffff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .stat-card {
      background: rgba(47, 49, 54, 0.9);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #43b581;
      text-align: center;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.4);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: #43b581;
      display: block;
    }

    .stat-label {
      color: #b9bbbe;
      font-size: 0.9rem;
      margin-top: 5px;
    }

    /* Card Principal */
    .user-info-container {
      background: linear-gradient(135deg, rgba(47, 49, 54, 0.95), rgba(64, 68, 75, 0.95));
      padding: 40px;
      margin-top: 40px;
      border-radius: 15px;
      display: inline-block;
      text-align: left;
      max-width: 1200px;
      width: 100%;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
      border: 2px solid #43b581;
      animation: scaleIn 0.5s ease-out 0.3s both;
      backdrop-filter: blur(10px);
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .user-info-container h2 {
      color: #ffffff;
      margin-top: 0;
      margin-bottom: 25px;
      font-size: 1.6rem;
      font-weight: 700;
      border-bottom: 2px solid #43b581;
      padding-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .section-icon {
      width: 24px;
      height: 24px;
      filter: brightness(0) saturate(100%) invert(68%) sepia(47%) saturate(824%) hue-rotate(88deg) brightness(118%) contrast(119%);
    }

    .info-section {
      margin-bottom: 35px;
      background: rgba(32, 34, 37, 0.6);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid #40444b;
    }

    .info-section:last-child {
      margin-bottom: 0;
    }

    /* Header do perfil */
    .profile-header-section {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 30px;
      align-items: center;
      padding: 30px;
      background: linear-gradient(135deg, rgba(114, 137, 218, 0.1), rgba(67, 181, 129, 0.1));
      border: 2px solid #7289da;
    }

    .avatar-display {
      text-align: center;
    }

    .avatar-display img {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 5px solid #43b581;
      background-color: #36393f;
      transition: all 0.3s ease;
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    }

    .avatar-display img:hover {
      transform: scale(1.1);
      box-shadow: 0 15px 35px rgba(67, 181, 129, 0.6);
    }

    .avatar-display p#currentAvatarMsg {
      font-size: 1rem;
      margin-top: 12px;
      color: #b9bbbe;
      font-weight: 500;
    }

    .user-details {
      flex-grow: 1;
    }

    .user-details h2 {
      border-bottom: none;
      padding-bottom: 0;
      margin-bottom: 20px;
      font-size: 2rem;
      background: linear-gradient(135deg, #7289da, #43b581);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .user-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .user-info-container p {
      font-size: 1.1rem;
      color: #dcddde;
      margin-bottom: 12px;
      line-height: 1.6;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .label {
      color: #43b581;
      font-weight: 600;
      display: inline-block;
      min-width: 120px;
      font-size: 1rem;
    }

    .value {
      color: #ffffff;
      font-weight: 500;
      background: rgba(67, 181, 129, 0.1);
      padding: 5px 12px;
      border-radius: 6px;
      border: 1px solid rgba(67, 181, 129, 0.3);
    }

    .placeholder {
      color: #8e9297;
      font-style: italic;
    }

    .status-online { color: #43b581 !important; }
    .status-offline { color: #747f8d !important; }
    .status-error { color: #f04747 !important; }

    .user-info-container ul {
      list-style-type: none;
      padding-left: 0;
      margin: 0;
    }

    .user-info-container ul li {
      padding: 15px 20px;
      margin-bottom: 10px;
      border: 1px solid #40444b;
      border-radius: 8px;
      color: #dcddde;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: rgba(64, 68, 75, 0.4);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-info-container ul li:hover {
      background: rgba(114, 137, 218, 0.15);
      border-color: #7289da;
      transform: translateX(5px);
    }

    .username-date {
      font-size: 0.9rem;
      color: #8e9297;
      font-style: italic;
    }

    .old-avatars-container {
      margin-top: 25px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 20px;
      justify-items: center;
    }

    .avatar-item {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .old-avatars-container img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #7289da;
      transition: all 0.3s ease;
      background-color: #36393f;
      cursor: pointer;
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }

    .old-avatars-container img:hover {
      transform: scale(1.2);
      box-shadow: 0 10px 20px rgba(114, 137, 218, 0.6);
      border-color: #43b581;
    }

    .avatar-date {
      font-size: 0.8rem;
      color: #8e9297;
      text-align: center;
    }

    #errorMessage {
      color: #f04747;
      background: linear-gradient(135deg, rgba(240, 71, 71, 0.1), rgba(240, 71, 71, 0.05));
      border: 2px solid rgba(240, 71, 71, 0.4);
      padding: 20px 25px;
      border-radius: 12px;
      margin-top: 25px;
      font-weight: 600;
      display: inline-block;
      animation: shake 0.5s ease-in-out;
      box-shadow: 0 8px 16px rgba(240, 71, 71, 0.2);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }

    .success-message {
      color: #43b581;
      background: linear-gradient(135deg, rgba(67, 181, 129, 0.1), rgba(67, 181, 129, 0.05));
      border: 2px solid rgba(67, 181, 129, 0.4);
      padding: 20px 25px;
      border-radius: 12px;
      margin-top: 25px;
      font-weight: 600;
      display: inline-block;
      box-shadow: 0 8px 16px rgba(67, 181, 129, 0.2);
    }

    .info-badge {
      display: inline-block;
      padding: 4px 8px;
      background: rgba(114, 137, 218, 0.2);
      border: 1px solid rgba(114, 137, 218, 0.4);
      border-radius: 4px;
      font-size: 0.8rem;
      color: #7289da;
      margin-left: 8px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      cursor: pointer;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      max-width: 90%;
      max-height: 90%;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.8);
      animation: scaleIn 0.3s ease-out;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .container {
        padding: 20px 15px;
      }

      h1.page-title {
        font-size: 2.5rem;
      }

      .logo {
        width: 120px;
        height: 120px;
      }

      .input-group {
        flex-direction: column;
        gap: 15px;
      }

      input {
        width: 100%;
        max-width: 400px;
      }

      .button-group {
        width: 100%;
        max-width: 400px;
      }

      button {
        flex: 1;
        min-width: auto;
      }

      .user-info-container {
        width: 100%;
        padding: 25px 20px;
        margin-top: 30px;
      }

      .profile-header-section {
        grid-template-columns: 1fr;
        text-align: center;
        gap: 20px;
      }

      .user-actions {
        align-items: center;
      }

      .avatar-display img {
        width: 120px;
        height: 120px;
      }

      .user-details h2 {
        font-size: 1.6rem;
      }

      .old-avatars-container {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 15px;
      }

      .old-avatars-container img {
        width: 80px;
        height: 80px;
      }

      .features-grid {
        grid-template-columns: 1fr;
      }

      .stats-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      h1.page-title {
        font-size: 2rem;
      }

      p.description {
        font-size: 1rem;
      }

      .user-info-container {
        padding: 20px 15px;
      }

      .stats-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://media.discordapp.net/attachments/1375545742675935314/1377352293313282068/CelestialDevRoleBadge.png?ex=6838a6c8&is=68375548&hm=93dc31b55a4847e14b072e4db5c338f7ed3d3386a96bf69fe1ef5f01b0a7f712&=&format=webp&quality=lossless" alt="Celestial Bot Icon" class="logo">
      <h1 class="page-title">Celestial User Tracker</h1>
      <p class="subtitle">Sistema Avançado de Rastreamento Discord</p>
      <p class="description">O Celestial User Tracker é uma ferramenta poderosa desenvolvida para rastrear e arquivar dados históricos de usuários do Discord. Nossa plataforma permite visualizar avatares antigos, histórico de nomes de usuário e outras informações relevantes que foram registradas ao longo do tempo pelo bot Celestial.</p>
    </div>

    <div class="features-info">
      <h3>🚀 Recursos Disponíveis</h3>
      <div class="features-grid">
        <div class="feature-item">
          <h4>📸 Galeria de Avatares</h4>
          <p>Visualize todos os avatares que o usuário já utilizou, organizados cronologicamente com data de registro.</p>
        </div>
        <div class="feature-item">
          <h4>👤 Histórico de Nomes</h4>
          <p>Acompanhe as mudanças de username e display names ao longo do tempo (quando disponível).</p>
        </div>
        <div class="feature-item">
          <h4>📊 Dados Detalhados</h4>
          <p>Informações completas sobre o perfil, incluindo ID, status atual e estatísticas de atividade.</p>
        </div>
        <div class="feature-item">
          <h4>🔍 Busca Avançada</h4>
          <p>Sistema de busca otimizado que encontra dados mesmo de usuários com pouca atividade registrada.</p>
        </div>
      </div>
    </div>
    
    <div class="search-container">
      <div class="input-group">
        <input type="text" id="userIdInput" placeholder="Digite o ID do usuário Discord (17-19 dígitos)" maxlength="20">
        <div class="button-group">
          <button id="searchBtn" class="btn-primary" onclick="buscarDadosUsuario()">
            <span class="btn-text">🔍 Buscar Dados</span>
          </button>
          <button id="clearBtn" class="btn-secondary" onclick="limparResultados()">
            <span class="btn-text">🗑️ Limpar</span>
          </button>
          <button id="helpBtn" class="btn-info" onclick="mostrarAjuda()">
            <span class="btn-text">❓ Ajuda</span>
          </button>
        </div>
      </div>
    </div>

    <div id="statsContainer" class="stats-container" style="display: none;">
      <div class="stat-card">
        <span id="totalAvatars" class="stat-number">0</span>
        <span class="stat-label">Avatares Encontrados</span>
      </div>
      <div class="stat-card">
        <span id="totalUsernames" class="stat-number">0</span>
        <span class="stat-label">Nomes Registrados</span>
      </div>
      <div class="stat-card">
        <span id="dataQuality" class="stat-number">0%</span>
        <span class="stat-label">Qualidade dos Dados</span>
      </div>
      <div class="stat-card">
        <span id="lastUpdate" class="stat-number">--</span>
        <span class="stat-label">Última Atualização</span>
      </div>
    </div>

    <div id="resultsContainer" style="display: none;">
      <div class="user-info-container">
        <div class="info-section profile-header-section">
          <div class="avatar-display">
            <img id="currentAvatarImg" src="#" alt="Avatar Atual" style="display: none;">
            <p id="currentAvatarMsg" class="placeholder">Carregando...</p>
          </div>
          <div class="user-details">
            <h2>👤 Informações do Usuário</h2>
            <p><span class="label">🆔 ID:</span> <span id="userInfoId" class="value placeholder">Carregando...</span></p>
            <p><span class="label">👋 Usuário:</span> <span id="currentUser" class="value placeholder">Carregando...</span></p>
            <p><span class="label">📊 Status:</span> <span id="userStatus" class="value placeholder">Verificando...</span></p>
            <p><span class="label">📅 Primeira Detecção:</span> <span id="firstSeen" class="value placeholder">Analisando...</span></p>
            <p><span class="label">🔄 Última Atividade:</span> <span id="lastSeen" class="value placeholder">Verificando...</span></p>
          </div>
          <div class="user-actions">
            <button class="btn-secondary" onclick="copiarId()">📋 Copiar ID</button>
            <button class="btn-info" onclick="exportarDados()">💾 Exportar</button>
            <button class="btn-primary" onclick="atualizarDados()">🔄 Atualizar</button>
          </div>
        </div>

        <div class="info-section">
          <h2>
            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21A2 2 0 0 0 5 23H19A2 2 0 0 0 21 21V9H21ZM19 21H5V3H13V9H19V21Z"/>
            </svg>
            📝 Histórico de Nomes de Usuário
            <span class="info-badge" id="usernameCount">0 registros</span>
          </h2>
          <ul id="oldUsernamesList">
            <li class="placeholder">🔄 Carregando histórico de nomes...</li>
          </ul>
        </div>
        
        <div class="info-section">
          <h2>
            <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9,11H7v8h2V11z M13,7h-2v12h2V7z M17,3h-2v16h2V3z"/>
            </svg>
            🖼️ Galeria de Avatares Antigos
            <span class="info-badge" id="avatarCount">0 avatares</span>
          </h2>
          <div class="old-avatars-container" id="oldAvatarsContainer">
            <p id="oldAvatarsMsg" class="placeholder">🔄 Carregando galeria de avatares...</p>
          </div>
        </div>
      </div>
    </div>
    
    <div id="messageContainer"></div>
  </div>

  <script>
    let currentUserData = null;

    function showMessage(message, type = 'error') {
      const messageContainer = document.getElementById('messageContainer');
      const messageElement = document.createElement('div');
      messageElement.className = type === 'error' ? '' : 'success-message';
      messageElement.id = type === 'error' ? 'errorMessage' : 'successMessage';
      messageElement.textContent = message;
      messageElement.style.display = 'block';
      
      messageContainer.innerHTML = '';
      messageContainer.appendChild(messageElement);
      
      setTimeout(() => {
        messageElement.style.opacity = '0';
        setTimeout(() => messageElement.remove(), 300);
      }, 6000);
    }

    function updateStats(avatarCount = 0, usernameCount = 0, quality = 0) {
      document.getElementById('totalAvatars').textContent = avatarCount;
      document.getElementById('totalUsernames').textContent = usernameCount;
      document.getElementById('dataQuality').textContent = quality + '%';
      document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('pt-BR');
      
      document.getElementById('avatarCount').textContent = `${avatarCount} avatares`;
      document.getElementById('usernameCount').textContent = `${usernameCount} registros`;
    }

    function initializeUserInfoFields() {
      document.getElementById('userInfoId').innerHTML = '<span class="placeholder">🔄 Carregando...</span>';
      document.getElementById('currentUser').innerHTML = '<span class="placeholder">🔄 Carregando...</span>';
      document.getElementById('userStatus').innerHTML = '<span class="placeholder">🔄 Verificando...</span>';
      document.getElementById('firstSeen').innerHTML = '<span class="placeholder">🔄 Analisando...</span>';
      document.getElementById('lastSeen').innerHTML = '<span class="placeholder">🔄 Verificando...</span>';
      
      const currentAvatarImg = document.getElementById('currentAvatarImg');
      currentAvatarImg.style.display = 'none';
      currentAvatarImg.src = '#';
      document.getElementById('currentAvatarMsg').style.display = 'block';
      document.getElementById('currentAvatarMsg').innerHTML = '<span class="placeholder">🔄 Carregando avatar...</span>';
      document.getElementById('currentAvatarMsg').className = 'placeholder';
      
      const oldUsernamesList = document.getElementById('oldUsernamesList');
      oldUsernamesList.innerHTML = '<li class="placeholder">🔄 Carregando histórico de nomes...</li>';
      
      const oldAvatarsContainer = document.getElementById('oldAvatarsContainer');
      oldAvatarsContainer.innerHTML = '<p id="oldAvatarsMsg" class="placeholder">🔄 Carregando galeria de avatares...</p>';

      document.getElementById('messageContainer').innerHTML = '';
      updateStats(0, 0, 0);
    }

    function copiarId() {
      const userId = document.getElementById('userIdInput').value.trim();
      if (userId) {
        navigator.clipboard.writeText(userId).then(() => {
          showMessage('✅ ID copiado para a área de transferência!', 'success');
        }).catch(() => {
          showMessage('❌ Erro ao copiar ID', 'error');
        });
      }
    }

    function exportarDados() {
      if (!currentUserData) {
        showMessage('❌ Nenhum dado disponível para exportar', 'error');
        return;
      }

      const data = {
        exportDate: new Date().toISOString(),
        userId: document.getElementById('userIdInput').value.trim(),
        userData: currentUserData,
        stats: {
          avatars: document.getElementById('totalAvatars').textContent,
          usernames: document.getElementById('totalUsernames').textContent,
          quality: document.getElementById('dataQuality').textContent
        }
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `celestial_user_${data.userId}_${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showMessage('💾 Dados exportados com sucesso!', 'success');
    }

    function atualizarDados() {
      if (document.getElementById('userIdInput').value.trim()) {
        buscarDadosUsuario();
      } else {
        showMessage('❌ Digite um ID de usuário para atualizar', 'error');
      }
    }

    function limparResultados() {
      document.getElementById('userIdInput').value = '';
      document.getElementById('resultsContainer').style.display = 'none';
      document.getElementById('statsContainer').style.display = 'none';
      document.getElementById('messageContainer').innerHTML = '';
      currentUserData = null;
      showMessage('🗑️ Resultados limpos com sucesso!', 'success');
    }

    function mostrarAjuda() {
      const helpText = `
🔍 COMO USAR O CELESTIAL TRACKER:

1️⃣ ENCONTRAR O ID DO USUÁRIO:
   • Clique com o botão direito no usuário no Discord
   • Selecione "Copiar ID do Usuário"
   • O ID deve ter entre 17-19 dígitos

2️⃣ BUSCAR DADOS:
   • Cole o ID no campo de busca
   • Clique em "Buscar Dados" ou pressione Enter
   • Aguarde o carregamento dos resultados

3️⃣ RECURSOS DISPONÍVEIS:
   • 📸 Visualizar avatares antigos
   • 👤 Histórico de nomes (quando disponível)
   • 📊 Estatísticas detalhadas
   • 💾 Exportar dados em JSON
   • 📋 Copiar informações

⚠️ IMPORTANTE:
   • Apenas usuários registrados pelo bot Celestial aparecem
   • Dados históricos dependem do período de monitoramento
   • Algumas informações podem não estar disponíveis

❓ Precisa de mais ajuda? Entre em contato com a equipe Celestial!
      `;
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div style="background: #2f3136; padding: 30px; border-radius: 15px; max-width: 600px; border: 2px solid #43b581;">
          <h3 style="color: #43b581; margin-top: 0;">📚 Guia do Celestial Tracker</h3>
          <pre style="color: #dcddde; line-height: 1.6; white-space: pre-wrap; font-family: inherit;">${helpText}</pre>
          <button onclick="this.parentElement.parentElement.remove()" style="background: #7289da; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-top: 20px; font-weight: 600;">✅ Entendi</button>
        </div>
      `;
      
      modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
      };
      
      document.body.appendChild(modal);
    }

    async function buscarDadosUsuario() {
      const userId = document.getElementById('userIdInput').value.trim();
      const resultsContainer = document.getElementById('resultsContainer');
      const statsContainer = document.getElementById('statsContainer');
      const searchBtn = document.getElementById('searchBtn');

      initializeUserInfoFields();

      if (!userId) {
        showMessage("❌ Por favor, insira um ID de usuário válido.", 'error');
        resultsContainer.style.display = 'none';
        statsContainer.style.display = 'none';
        return;
      }

      if (!/^\d{17,19}$/.test(userId)) {
        showMessage("❌ ID do Discord deve conter apenas números e ter entre 17-19 dígitos.", 'error');
        resultsContainer.style.display = 'none';
        statsContainer.style.display = 'none';
        return;
      }
      
      searchBtn.classList.add('loading');
      searchBtn.querySelector('.btn-text').textContent = '🔍 Buscando...';
      
      resultsContainer.style.display = 'block';
      statsContainer.style.display = 'flex';

      try {
        const avatarResponse = await fetch(`https://celestial-api.onrender.com/api/avatars/${userId}`);
        
        if (!avatarResponse.ok) {
          let errorMsg = `Erro ${avatarResponse.status}: ${avatarResponse.statusText}`;
          try {
            const errorData = await avatarResponse.json();
            if (errorData && errorData.error) {
              errorMsg = errorData.error;
            } else if (avatarResponse.status === 404) {
              errorMsg = "❌ Usuário não encontrado na base de dados do Celestial. O usuário pode não ter sido monitorado pelo bot ou não possui dados registrados.";
            }
          } catch (e) {
            if (avatarResponse.status === 404) {
              errorMsg = "❌ Usuário não encontrado na base de dados do Celestial.";
            }
          }
          throw new Error(errorMsg);
        }
        
        const avatarData = await avatarResponse.json();
        currentUserData = avatarData;

        // Atualizar informações básicas
        document.getElementById('userInfoId').innerHTML = `<span class="value">🆔 ${userId}</span>`;
        document.getElementById('currentUser').innerHTML = '<span class="placeholder">👤 Não disponível via API</span>';
        document.getElementById('userStatus').innerHTML = '<span class="value status-online">✅ Dados encontrados</span>';
        document.getElementById('firstSeen').innerHTML = '<span class="placeholder">📅 Primeira detecção não disponível</span>';
        document.getElementById('lastSeen').innerHTML = '<span class="placeholder">🔄 Última atividade não disponível</span>';
        
        // Avatar atual
        document.getElementById('currentAvatarMsg').innerHTML = '<span class="placeholder">🖼️ Avatar atual não disponível via API</span>';
        document.getElementById('currentAvatarMsg').className = 'placeholder';
        document.getElementById('currentAvatarImg').style.display = 'none';

        // Histórico de nomes
        document.getElementById('oldUsernamesList').innerHTML = '<li class="placeholder">📝 Histórico de nomes não disponível via API<div class="username-date">Esta informação não está incluída na API atual</div></li>';

        // Processar avatares antigos
        const oldAvatarsContainer = document.getElementById('oldAvatarsContainer');
        if (avatarData && avatarData.avatars && avatarData.avatars.length > 0) {
          oldAvatarsContainer.innerHTML = "";
          let loadedImages = 0;
          const totalImages = avatarData.avatars.length;
          
          avatarData.avatars.forEach((url, index) => {
            const avatarItem = document.createElement("div");
            avatarItem.className = "avatar-item";
            
            const img = document.createElement("img");
            img.src = url;
            img.alt = `Avatar antigo ${index + 1}`;
            img.title = `Avatar ${index + 1} - Clique para ampliar`;
            
            const dateSpan = document.createElement("span");
            dateSpan.className = "avatar-date";
            dateSpan.textContent = `Avatar #${index + 1}`;
            
            img.onload = () => {
              loadedImages++;
              if (loadedImages === totalImages) {
                const quality = Math.min(100, Math.round((totalImages / 10) * 100));
                updateStats(totalImages, 0, quality);
                showMessage(`✅ ${totalImages} avatar(s) carregado(s) com sucesso! Qualidade dos dados: ${quality}%`, 'success');
              }
            };
            
            img.onerror = () => {
              img.alt = "❌ Avatar indisponível";
              img.style.border = "3px dashed #f04747";
              img.style.opacity = "0.5";
              dateSpan.textContent = "❌ Erro";
              dateSpan.style.color = "#f04747";
              loadedImages++;
            };
            
            img.onclick = () => {
              const modal = document.createElement('div');
              modal.className = 'modal-overlay';
              
              const modalImg = document.createElement('img');
              modalImg.src = url;
              modalImg.className = 'modal-content';
              modalImg.style.cssText = 'max-width: 90%; max-height: 90%; border-radius: 15px;';
              
              modal.appendChild(modalImg);
              modal.onclick = () => modal.remove();
              document.body.appendChild(modal);
            };
            
            avatarItem.appendChild(img);
            avatarItem.appendChild(dateSpan);
            oldAvatarsContainer.appendChild(avatarItem);
          });
        } else {
          oldAvatarsContainer.innerHTML = '<p class="placeholder">🚫 Nenhum avatar antigo encontrado para este usuário.<br><small>O usuário pode ter apenas um avatar ou não foi monitorado por tempo suficiente.</small></p>';
          updateStats(0, 0, 0);
        }

      } catch (err) {
        console.error("Erro ao buscar dados:", err);
        showMessage(`❌ ${err.message}`, 'error');
        
        // Atualizar campos com erro
        document.getElementById('userInfoId').innerHTML = `<span class="value">🆔 ${userId}</span>`;
        document.getElementById('currentUser').innerHTML = '<span class="placeholder status-error">❌ Erro ao carregar</span>';
        document.getElementById('userStatus').innerHTML = '<span class="value status-error">❌ Erro na consulta</span>';
        document.getElementById('firstSeen').innerHTML = '<span class="placeholder status-error">❌ Erro ao carregar</span>';
        document.getElementById('lastSeen').innerHTML = '<span class="placeholder status-error">❌ Erro ao carregar</span>';
        document.getElementById('currentAvatarMsg').innerHTML = '<span class="placeholder status-error">❌ Erro ao carregar avatar</span>';
        document.getElementById('currentAvatarMsg').className = 'placeholder';
        document.getElementById('currentAvatarImg').style.display = 'none';
        document.getElementById('oldUsernamesList').innerHTML = '<li class="placeholder status-error">❌ Erro ao carregar histórico</li>';
        document.getElementById('oldAvatarsContainer').innerHTML = '<p class="placeholder status-error">❌ Erro ao carregar avatares.<br><small>Verifique se o ID está correto e tente novamente.</small></p>';
        
        updateStats(0, 0, 0);
      } finally {
        searchBtn.classList.remove('loading');
        searchBtn.querySelector('.btn-text').textContent = '🔍 Buscar Dados';
      }
    }

    // Event listeners
    document.getElementById('userIdInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        buscarDadosUsuario();
      }
    });

    // Validação em tempo real do input
    document.getElementById('userIdInput').addEventListener('input', function(e) {
      const value = e.target.value;
      if (value && !/^\d*$/.test(value)) {
        e.target.value = value.replace(/\D/g, '');
      }
    });

    // Inicializar estatísticas
    updateStats(0, 0, 0);
  </script>
</body>
</html>
